import{w as v,t as C,r as c,K as P,E as j,J as y,s as k,j as e,L as b,q as m}from"./index-DzAjOP52.js";import E from"./Loading-Jt0hUpEy.js";import{F as S}from"./index-D-soKq7i.js";import{C as U,a as D,e as F}from"./card-H--TocNl.js";import{A as R,a as $,b as L}from"./avatar-CgiIn2Yp.js";let I="https://articles.api.acosta.net.ar/api/v1/";const N=I+"user",M=async(r,i)=>(console.log("Fetching profile for user ID:",r),(await v.get(`${N}/${r}`,{headers:{Authorization:`Bearer ${i}`}})).data),B=async(r,i,a)=>(await v.put(`${N}/${r}`,i,{headers:{Authorization:`Bearer ${a}`}})).data,z=()=>{const{token:r,isAuthenticated:i}=C(),[a,n]=c.useState(null),[p,l]=c.useState(!1),[o,d]=c.useState(null),f=c.useCallback(async()=>{if(r){l(!0);try{const s=P(r);console.log("Token:",r),console.log("Decoded token:",s),console.log("Fetching profile for user ID:",s.id);const t=await M(s.id,r);n(t)}catch(s){if(console.error("Error fetching profile:",s),s.response&&s.response.status===429)d(new Error("Rate limit exceeded. Please try again later.")),j.error("Rate limit exceeded. Please try again later.");else{d(s);const t=s.response?.data?.error||s.response?.data?.message||s.message||"An error occurred";j.error(t,{duration:3e3,action:{label:"Close",onClick:()=>{}}})}}finally{l(!1)}}},[r]),x=c.useCallback(async s=>{if(!(!r||!a)){l(!0);try{const t=await B(a.id,s,r);return console.log("Profile updated on backend:",t),n(t),t}catch(t){const h=t.response?.data?.error||t.response?.data?.message||t.message||"An error occurred";throw j.error(h,{duration:3e3,action:{label:"Close",onClick:()=>{}}}),d(t),t}finally{l(!1)}}},[r,a]);return c.useEffect(()=>{i?f():n(null)},[i,f]),{profile:a,setProfile:n,updateProfile:x,loading:p,error:o}};function O(){const[r,i]=y.useState({}),[a,n]=y.useState(!1),{isAuthenticated:p,isAdmin:l}=C(),{profile:o,loading:d,updateProfile:f}=z(),x=k();if(d)return e.jsx(E,{});if(!o)return e.jsx("p",{children:"No profile data available"});const s=()=>{n(!0)},t=u=>{const{name:g,value:w}=u.target;i(A=>({...A,[g]:w}))},h=async u=>{u.preventDefault();try{await f(r)}catch(g){console.error("Error updating profile:",g)}finally{n(!1)}};return p()||x("/login"),e.jsx("section",{className:"block mx-auto justify-center min-h-screen px-4 py-12",children:e.jsx(S,{cascade:!0,triggerOnce:!0,duration:500,children:e.jsxs(U,{className:"w-full max-w-md mx-auto shadow-lg",children:[e.jsxs(D,{className:"flex flex-col items-center gap-4",children:[e.jsxs(R,{className:"w-24 h-24 outline",children:[e.jsx($,{src:`https://api.dicebear.com/9.x/notionists-neutral/svg?seed=${o?.username}`,alt:o.username}),e.jsx(L,{children:o.username.split(" ").map(u=>u[0]).join("").slice(0,2).toUpperCase()})]}),e.jsxs("div",{children:[a?e.jsx("h2",{className:"text-2xl font-bold text-center",children:e.jsx("input",{type:"text",value:r.username||o.username,onChange:t,name:"username",className:"mt-1 block w-full rounded-md border-border bg-input px-3 py-2 text-sm shadow-sm placeholder:text-muted-foreground focus:border-primary focus:ring-1 focus:ring-primary"})}):e.jsx("h2",{className:"text-2xl font-bold text-center",children:o.username}),e.jsx("p",{className:"text-sm text-muted-foreground text-center",children:o.email}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground text-center",children:o.admin?"Admin":"User"})]})]}),e.jsxs(F,{className:"flex flex-col md:flex-row justify-center gap-4",children:[l&&!a&&e.jsx(b,{to:"/manageArticles",children:e.jsx(m,{variant:"outline",className:"cursor-pointer",children:"Manage Articles"})}),l&&!a&&e.jsx(b,{to:"/adminUsers",children:e.jsx(m,{variant:"outline",className:"cursor-pointer",children:"Manage Users"})}),a?e.jsx(m,{className:"cursor-pointer",onClick:h,children:"Save"}):e.jsx(m,{variant:"outline",className:"cursor-pointer",onClick:s,children:"Edit Profile"}),a&&e.jsx(m,{variant:"outline",className:"cursor-pointer",onClick:()=>n(!1),children:"Cancel"})]})]})})})}export{O as default};
